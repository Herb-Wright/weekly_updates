<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="" >

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
            <title>Herbie‚Äôs Weekly Update üóìÔ∏è</title>
  <style>
    /*
     * I add this to html files generated with pandoc.
     */

    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap');

     html {
        font-size: 100%;
        overflow-y: scroll;
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
    }

    body {
        color: #444;
        font-family: "Open Sans", sans-serif;
        font-weight: 450;
        font-size: 12px;
        line-height: 1.7;
        padding: 1em;
        margin: auto;
        max-width: 800px;
        background: #fefefe;
        padding-bottom: 10rem;
        text-align: justify;
    }

    a {
        color: #0645ad;
        text-decoration: none;
    }

    a:visited {
        color: #0b0080;
    }

    a:hover {
        color: #06e;
    }

    a:active {
        color: #faa700;
    }

    a:focus {
        outline: thin dotted;
    }

    *::-moz-selection {
        background: rgba(255, 255, 0, 0.3);
        color: #000;
    }

    *::selection {
        background: rgba(255, 255, 0, 0.3);
        color: #000;
    }

    a::-moz-selection {
        background: rgba(255, 255, 0, 0.3);
        color: #0645ad;
    }

    a::selection {
        background: rgba(255, 255, 0, 0.3);
        color: #0645ad;
    }

    p {
        margin: 1em 0;
    }

    img {
        max-height: 350px;
        max-width: 100%;
    }

    video {
        max-height: 350px;
        max-width: 100%;
    }

    h1, h2, h3, h4, h5, h6 {
        color: #111;
        line-height: 125%;
        margin-top: 2em;
        font-weight: normal;
        font-family: "Plus Jakarta Sans", sans-serif;
        font-weight: 250;

    }

    h4, h5, h6 {
        font-weight: bold;
    }

    h1 {
        font-size: 2.25em;
        text-decoration: dotted underline;
    }

    h2 {
        font-size: 1.875em;
    }

    h3 {
        font-size: 1.5em;
    }

    h4 {
        font-size: 1.25em;
    }

    h5 {
        font-size: 1em;
    }

    h6 {
        font-size: 0.9em;
    }

    blockquote {
        color: #666666;
        margin: 0;
        padding-left: 3em;
        border-left: 0.5em #EEE solid;
    }

    hr {
        display: block;
        height: 2px;
        border: 0;
        border-top: 1px solid #aaa;
        border-bottom: none;
        margin: 1em 0;
        padding: 0;
    }

    pre, code, kbd, samp {
        color: #111;
        font-family: Consolas, monospace, monospace;
        _font-family: 'courier new', monospace;
        font-size: 0.98em;
        background-color: #f2f1f1;
        padding: 0.2em;
        border-radius: 0.25em;
    }

    pre {
        white-space: pre;
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    b, strong {
        font-weight: bold;
    }

    dfn {
        font-style: italic;
    }

    ins {
        background: #ff9;
        color: #000;
        text-decoration: none;
    }

    mark {
        background: #ff0;
        color: #000;
        font-style: italic;
        font-weight: bold;
    }

    sub, sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
    }

    sup {
        top: -0.5em;
    }

    sub {
        bottom: -0.25em;
    }

    ul, ol {
        margin: 1em 0;
        padding: 0 0 0 2em;
    }

    li {
        margin-bottom: 0.25em;
    }

    li:last-child p:last-child {
        margin-bottom: 0;
    }

    ul ul, ol ol {
        margin: 0;
    }

    dl {
        margin-bottom: 1em;
    }

    dt {
        font-weight: bold;
        margin-bottom: .8em;
    }

    dd {
        margin: 0 0 .8em 2em;
    }

    dd:last-child {
        margin-bottom: 0;
    }

    img {
        border: 0;
        -ms-interpolation-mode: bicubic;
        vertical-align: middle;
    }

    figure {
        display: block;
        text-align: center;
        margin: 1em 0;
    }

    figure img {
        border: none;
        margin: 0 auto;
    }

    figcaption {
        font-size: 0.8em;
        font-style: italic;
        margin: 0 0 .8em;
    }

    table {
        margin-bottom: 2em;
        border-bottom: 1px solid #ddd;
        border-right: 1px solid #ddd;
        border-spacing: 0;
        border-collapse: collapse;
    }

    table th {
        padding: .2em 1em;
        background-color: #eee;
        border-top: 1px solid #ddd;
        border-left: 1px solid #ddd;
    }

    table td {
        padding: .2em 1em;
        border-top: 1px solid #ddd;
        border-left: 1px solid #ddd;
        vertical-align: top;
    }

    .author {
        font-size: 1.2em;
        text-align: center;
    }

    span.display {
        overflow: auto;
        max-width: 100%;
        display: block;
    }

    #title-block-header {
        text-align: left;
        margin-bottom: 4em;
    }

    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  

    @media only screen and (min-width: 480px) {
        body {
            font-size: 14px;
        }
    }
    @media only screen and (min-width: 768px) {
        body {
            font-size: 16px;
        }
    }
    @media print {
        * {
            background: transparent !important;
            filter: none !important;
            -ms-filter: none !important;
        }

        body {
            font-size: 9pt;
            line-height: 1.5;
            max-width: 100%;
            padding-bottom: 0pt;
            color: black;
        }

        /* a, a:visited {
            text-decoration: underline;
        } */

        hr {
            height: 1px;
            border: 0;
            border-bottom: 1px solid black;
        }

        /* a[href]:after {
            content: " (" attr(href) ")";
        } */
    /* 
        a {
            color: var(--sky-800);
        } */

        abbr[title]:after {
            content: " (" attr(title) ")";
        }

        video {
            display: none;
        }

        video + figcaption::before {
            content: "[Video not available in print/pdf] \A";
            display: block;
            margin-top: 0.5em;
            font-size: 9pt;
            color: #666;
            font-style: italic;
        }

        .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
            content: "";
        }

        pre, blockquote {
            border: 1px solid #999;
            padding-right: 1em;
            page-break-inside: avoid;
        }

        tr, img {
            page-break-inside: avoid;
        }

        img {
            max-width: 100% !important;
            max-height: 150pt;
        }

        p, h2, h3 {
            orphans: 3;
            widows: 3;
        }

        h2, h3 {
            page-break-after: avoid;
        }

        h1, h2, h3, h4, h5, h6 {
            margin-top: 1.25em;
            margin-bottom: 0.5em;
        }

        p, li, #refs {
            margin: 0.5em 0;
            font-size: 11pt;
        }

        li {
            margin-top: 0em;
            margin-bottom: 0.25em;
        }

        .printIgnore, #TOC  {
            display: none;
        }

        table {
            border: 1pt solid #444;
            /* border-right: 1pt solid #444; */
        }
        
        table th {
            /* border-top: 1pt solid #444; */
            border: 1pt solid #444;
        }
        
        table td {
            /* border-top: 1pt solid #444;
            border-left: 1pt solid #444; */
            border-top: none;
            /* border-bottom: none; */
            border-left: 1pt solid #444;
        }

        span.display {
            overflow: visible;
        }
    }

    @page {
        /* Set the margin for the physical piece of paper */
        /* margin: 1in;  */
        margin: 2cm;
        
        /* Optional: Set paper size if you know it's always A4 or Letter */
        /* size: Letter; */
    }


    pre > code.sourceCode { white-space: pre; position: relative; }
        pre > code.sourceCode > span { line-height: 1.25; }
        pre > code.sourceCode > span:empty { height: 1.2em; }
        .sourceCode { overflow: visible; }
        code.sourceCode > span { color: inherit; text-decoration: inherit; }
        div.sourceCode { margin: 1em 0; }
        pre.sourceCode { margin: 0; }
        @media screen {
        div.sourceCode { overflow: auto; }
        }
        @media print {
        pre > code.sourceCode { white-space: pre-wrap; }
        pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
        }
        pre.numberSource code
          { counter-reset: source-line 0; }
        pre.numberSource code > span
          { position: relative; left: -4em; counter-increment: source-line; }
        pre.numberSource code > span > a:first-child::before
          { content: counter(source-line);
            position: relative; left: -1em; text-align: right; vertical-align: baseline;
            border: none; display: inline-block;
            -webkit-touch-callout: none; -webkit-user-select: none;
            -khtml-user-select: none; -moz-user-select: none;
            -ms-user-select: none; user-select: none;
            padding: 0 4px; width: 4em;
            background-color: #ffffff;
            color: #a0a0a0;
          }
        pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
        div.sourceCode
          { color: #1f1c1b; background-color: #ffffff; }
        @media screen {
        pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
        }
        code span { color: #1f1c1b; } /* Normal */
        code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
        code span.an { color: #ca60ca; } /* Annotation */
        code span.at { color: #0057ae; } /* Attribute */
        code span.bn { color: #b08000; } /* BaseN */
        code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
        code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
        code span.ch { color: #924c9d; } /* Char */
        code span.cn { color: #aa5500; } /* Constant */
        code span.co { color: #898887; } /* Comment */
        code span.cv { color: #0095ff; } /* CommentVar */
        code span.do { color: #607880; } /* Documentation */
        code span.dt { color: #0057ae; } /* DataType */
        code span.dv { color: #b08000; } /* DecVal */
        code span.er { color: #bf0303; text-decoration: underline; } /* Error */
        code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
        code span.fl { color: #b08000; } /* Float */
        code span.fu { color: #644a9b; } /* Function */
        code span.im { color: #ff5500; } /* Import */
        code span.in { color: #b08000; } /* Information */
        code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
        code span.op { color: #1f1c1b; } /* Operator */
        code span.ot { color: #006e28; } /* Other */
        code span.pp { color: #006e28; } /* Preprocessor */
        code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
        code span.sc { color: #3daee9; } /* SpecialChar */
        code span.ss { color: #ff5500; } /* SpecialString */
        code span.st { color: #bf0303; } /* String */
        code span.va { color: #0057ae; } /* Variable */
        code span.vs { color: #bf0303; } /* VerbatimString */
        code span.wa { color: #bf0303; } /* Warning */  </style>
    <link rel="stylesheet" href="_template/styles.css" />
      <script defer=""
    src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
    var mathElements = document.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
      katex.render(texText.data, mathElements[i], {
        displayMode: mathElements[i].classList.contains('display'),
        throwOnError: false,
        macros: macros,
        fleqn: false
      });
    }}});
  </script>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>

<body>
      <header id="title-block-header">
        <h1 class="title">Herbie‚Äôs Weekly Update üóìÔ∏è</h1>
                <p class="date">2026 Jan 9</p>
          </header>
      <nav id="TOC" role="doc-toc">
        <ul>
        <li><a href="#last-time" id="toc-last-time">1. Last
        Time</a></li>
        <li><a href="#recall-the-project" id="toc-recall-the-project">2.
        Recall the Project</a></li>
        <li><a href="#pd-controller-and-k"
        id="toc-pd-controller-and-k">3. PD Controller and <span
        class="math inline">K</span></a></li>
        <li><a href="#reweighting-the-samples"
        id="toc-reweighting-the-samples">4. Reweighting the
        Samples</a></li>
        <li><a href="#towards-cube-pivoting"
        id="toc-towards-cube-pivoting">5. Towards Cube Pivoting</a></li>
        <li><a href="#references"
        id="toc-references">References</a></li>
        </ul>
  </nav>
    <h2 id="last-time">1. Last Time</h2>
    <p>Last meeting was all the way back in mid-December, where I had a
    suite of fairly simple experimental setups for the project. We spent
    the meeting mostly discussing a few things such as (a) reweighting
    samples for sysID; (b) The fact that <span
    class="math inline">u</span> w.r.t. <span
    class="math inline">\mu</span> has the wrong relationship in the
    first few iterations of ADMM; (c) potentially doing a lag thing
    where we allow <span class="math inline">x_0</span> to be varied (or
    alternatively <span class="math inline">x_1</span> is varied, <span
    class="math inline">u_0</span> is fixed). In this write-up, I want
    to have a brief reminder of what the project is and some updates on
    it.</p>
    <p>The cliff notes version of this write-up is:</p>
    <ul>
    <li>You can combine optimizing <span class="math inline">K</span>
    and <span class="math inline">K</span> being a PD controller‚Äîsimply
    regularize <span class="math inline">K</span> towards a PD
    controller (<a href="#pd-controller-and-k">¬ß3</a>)</li>
    <li>We can use a simpler version of violation-based LCS loss for
    reweighting, but QP timing might be an issue (<a
    href="#reweighting-the-samples">¬ß4</a>)</li>
    <li>I have implemented the delayed/lagged version of RC3+ (<a
    href="#changes-to-the-algo">¬ß5.1</a>)</li>
    <li>Anitescu friction causes poor C3+ plans on the block pivoting
    task and I am struggling to get C3+ working for it (<a
    href="#trying-to-get-cube-pivoting-to-work">¬ß5.2</a>)</li>
    </ul>
    <h2 id="recall-the-project">2. Recall the Project</h2>
    <h3 id="the-pitch">2.1. The Pitch</h3>
    <p>Here is a quick overview of the pitch for the project:</p>
    <ul>
    <li><strong>Potential Title:</strong> <em>Efficient ADMM-based
    Robust Contact-Implicit Control</em></li>
    <li><strong>Motivation:</strong> Current contact-implicit MPC
    approaches ignore uncertainty‚Äîwhich is all too common in real world
    scenarios‚Äîwhereas, on the other hand, most robust control approaches
    cannot handle complementarity constraints. Thus, there is room for
    an efficient method that performs contact-implicit robust control in
    a way that can handle general uncertainties.</li>
    <li><strong>Method:</strong> We would introduce a method for
    contact-implicit robust control that uses GPU parallelization to
    generate distributionally robust feedback plans. Our method would
    use samples to solve an expectation based loss with that becomes
    basic matrix operations and some linear solves with the ADMM
    algorithm. We would also include a reweighting for system
    identification.</li>
    <li><strong>Experiments:</strong> Our experiments would aim to show
    that (i) there are circumstances where a robust approach outperforms
    C3+ w/ a PD controller; (ii) Both the reweighting and
    sampling/steering improve performance with the method; (iii) It can
    work real-time in the real world. Here is an image from last time of
    some potential experiments:</li>
    </ul>
    <figure>
    <img src="./image.png"
    alt="Potential experiments from last time. I have circled my current top 3" />
    <figcaption aria-hidden="true">Potential experiments from last time.
    I have circled my current top 3</figcaption>
    </figure>
    <h3 id="some-related-works">2.2. Some Related Works</h3>
    <p>This section is just a paragraph mentioning the papers that I
    think are most relevant. Obviously, this idea could be seen as an
    extension of C3+ <span class="citation" data-cites="bui2025push"><a
    href="#ref-bui2025push" role="doc-biblioref">[1]</a></span>, which
    itself is an extension of C3 <span class="citation"
    data-cites="aydinoglu2024consensus"><a
    href="#ref-aydinoglu2024consensus"
    role="doc-biblioref">[2]</a></span> to the robust control setting.
    Robust control with complementarity constraints has not been widely
    studied. The most relevant work is Shirai et al <span
    class="citation" data-cites="shirai2023covariance"><a
    href="#ref-shirai2023covariance"
    role="doc-biblioref">[3]</a></span>, where they also use a
    sampling-based approach to formulate a large NLP and solve. They
    also use a cost on the expected value instead of the expected value
    of the cost, then control the variance of the distribution via a
    chance constraint. This approach is incredibly inefficient as it
    requires many samples for even toy problems and requires solving a
    very large NLP. There are also other potentially relevant papers
    from the same author <span class="citation"
    data-cites="shirai2023chance shirai2024robust shirai2025linear"><a
    href="#ref-shirai2023chance" role="doc-biblioref">[4]</a>‚Äì<a
    href="#ref-shirai2025linear" role="doc-biblioref">[6]</a></span>. It
    should be noted that covariance steering has been studied <span
    class="citation" data-cites="bakolas2016optimal liu2024optimal"><a
    href="#ref-bakolas2016optimal" role="doc-biblioref">[7]</a>, <a
    href="#ref-liu2024optimal" role="doc-biblioref">[8]</a></span>, but
    usually only in the case of linearized dynamics and Gaussians. I
    have also mentioned the robust pushing paper by Jankowski et al
    <span class="citation" data-cites="jankowski2025robust"><a
    href="#ref-jankowski2025robust" role="doc-biblioref">[9]</a></span>,
    where they focus soley on pose uncertainty and rely on a quasistatic
    model of contact dynamics. Another related paper is Drnach and Zhao
    <span class="citation" data-cites="drnach2021robust"><a
    href="#ref-drnach2021robust" role="doc-biblioref">[10]</a></span>,
    where they use expected residual minimization (ERM) <span
    class="citation" data-cites="chen2005expected"><a
    href="#ref-chen2005expected" role="doc-biblioref">[11]</a></span> to
    basically raise the complementarity constraint into the objective in
    an effort to solve for more robust locomotion plans under terrain
    uncertainty. While ERM has showed up in more than one robotics
    papers (i.e. <span class="citation"
    data-cites="tassa2010stochastic"><a href="#ref-tassa2010stochastic"
    role="doc-biblioref">[12]</a></span>), it is a related, yet
    fundamentally different problem. On another note, as mentioned in
    <span class="citation" data-cites="jankowski2025robust"><a
    href="#ref-jankowski2025robust" role="doc-biblioref">[9]</a></span>,
    I think the modern reinforcement learning (RL) practice of domain
    randomization <span class="citation" data-cites="tobin2017domain"><a
    href="#ref-tobin2017domain" role="doc-biblioref">[13]</a></span>
    offers good motivation for robust control in our case. There is some
    evidence that simply system identification is not enough for a good
    policy <span class="citation" data-cites="lambert2020objective"><a
    href="#ref-lambert2020objective"
    role="doc-biblioref">[14]</a></span>. Actually, speaking of <span
    class="citation" data-cites="lambert2020objective"><a
    href="#ref-lambert2020objective"
    role="doc-biblioref">[14]</a></span>, I have some minor concerns
    with the paper, and if there is extra time, might want to discuss
    it.</p>
    <h3 id="other-thoughts">2.3. Other Thoughts</h3>
    <p><strong>Contributions:</strong> In order for this work to be a
    solid paper, it needs to have a few clear contributions. I am
    thinking the contributions could be packaged like this:</p>
    <ol type="1">
    <li>A novel, highly-efficient, GPU-accelerated method for
    contact-implicit robust control with steering capable of running at
    real-time rates</li>
    <li>An efficient method for probabilistic system identification for
    linear complementarity systems</li>
    <li>Experiments showing the efficiency and effectiveness of the
    method.</li>
    </ol>
    <p>Part of me wonders if there is a way to break contribution 1.
    into a couple different contributions, perhaps by emphasizing the
    steering/feedback in some way. I also feel that contribution 2. is
    the most tentative and subject to change.</p>
    <p><strong>Motivating Robustness:</strong> In order for this to
    become a paper, it needs to convince reviewers of the importance of
    caring about robust control. I have mentioned using domain
    randomization in RL as motivation. In that case, it is motivated as
    an approach to overcome the <em>reality gap</em>‚Äîor overcome
    mismatches between the model and the real system behavior, because
    often there will always be a mismatch, no matter how good your
    system identification is. On the other hand, the way robust control
    is usually motivated is by recognizing that there exists uncertainty
    in whatever you are doing. I think that these two justifications are
    similar but are definitely different.</p>
    <p><strong>Venue:</strong> Previously, it was floated that IROS
    might be a good spot for this paper. If we aim for IROS, the
    deadline is <strong>March 1st</strong>, which is about 7 weeks
    away.</p>
    <h2 id="pd-controller-and-k">3. PD Controller and <span
    class="math inline">K</span></h2>
    <p>We have discussed having <span class="math inline">K</span>
    simply be a PD controller, and I talked to Hien about C3+ <span
    class="citation" data-cites="bui2025push"><a href="#ref-bui2025push"
    role="doc-biblioref">[1]</a></span>, who mentioned the importance of
    having a PD controller that also tracks the predicted state/velocity
    of the EE, instead of just using the <span
    class="math inline">u</span>‚Äôs from C3+. This made me think a bit,
    and I figured there is an easy way to get the best of both worlds:
    we can simply regularize <span class="math inline">K</span> toward a
    PD controller instead of <span class="math inline">0</span>. We
    would simply replace the <span class="math inline">\alpha \| K
    \|^2</span> with <span class="math inline">\alpha \|K - \tilde
    K\|^2</span> where: <span class="math display"> \tilde K = [0, -K_p,
    0, -K_d] </span> is a PD controller. This doesn‚Äôt at all change the
    complexity of the ADMM step as you can simply apply an offset to the
    data: <span class="math display"> \tilde u^{(i)} = u^{(i)} - \tilde
    K x^{(i)} </span> Then we can solve for <span
    class="math inline">\bar K^*, v^*</span> via ridge regression like
    before and let <span class="math inline">K = \bar K + \tilde
    K</span>.</p>
    <p>This has the effect of having <span class="math inline">K</span>
    be biased towards a PD controller which is probably better than
    <span class="math inline">K</span> being biased towards <span
    class="math inline">K=0</span>.</p>
    <p><strong>Question:</strong> <em>What do we think about this
    idea?</em></p>
    <h2 id="reweighting-the-samples">4. Reweighting the Samples</h2>
    <p>One thing we discussed was that we could weight the samples
    according to a loss similar to ContactNets <span class="citation"
    data-cites="pfrommer2021contactnets"><a
    href="#ref-pfrommer2021contactnets"
    role="doc-biblioref">[15]</a></span> for a linear complementarity
    system (LCS), like was introduced in Jin et al <span
    class="citation" data-cites="jin2022learning"><a
    href="#ref-jin2022learning" role="doc-biblioref">[16]</a></span> and
    inspired the residual learning in Huang et al <span class="citation"
    data-cites="huang2024adaptive"><a href="#ref-huang2024adaptive"
    role="doc-biblioref">[17]</a></span>. That loss would basically
    reweight our different LCS samples based on how likely the past
    observations are. Of course, I think before reaching for heavy
    machinery like solving a bunch of quadratic programs (QPs), we could
    just run Mujoco‚Äôs <span class="citation"
    data-cites="todorov2012mujoco"><a href="#ref-todorov2012mujoco"
    role="doc-biblioref">[18]</a></span> underlying step functions and
    compare which one best matches the result. Basically, we are
    interested in solving our MPC problem with respect to a posterior
    distribution. By Bayes rule: <span class="math display"> \mathbb
    E_{\xi \sim P(\xi | D)} \left[ C(\pi) \right] \propto \mathbb E_{\xi
    \sim P(\xi)} \left[P(D | \xi) C(\pi) \right] </span> Thus, we sample
    from our prior and reweight according to our likelihood. But what
    should this likelihood, <span class="math inline">P(D | \xi)</span>,
    be in practice?</p>
    <p>Well, in the <em>Learning Linear Complementarity Systems</em>
    paper <span class="citation" data-cites="jin2022learning"><a
    href="#ref-jin2022learning" role="doc-biblioref">[16]</a></span>,
    based on a strongly-convex quadratic program equivalent to an LCP,
    the following loss was proposed: <span class="math display">
    L(\texttt{LCS}) = \sum_t \min_{\lambda, \phi} \| A x_t + B u_t + C
    \lambda + d - x_{t+1} \|^2 + \frac{1}{\epsilon} \left(\lambda^\top
    \phi + \frac{1}{2\gamma}\| F \lambda + q_t - \phi  \|^2\right)
    </span> In this loss, an additional decision variable, <span
    class="math inline">\phi</span>, is introduced to capture <span
    class="math inline">F \lambda + q_t</span>. In the paper, this was
    justified by saying that (a) avoids numerical instability during
    differentiation, and (b) smooths the loss a bit aiding first order
    optimizers. However, neither of these matter much in our reweighting
    case, because we are not differentiating through our likelihood.
    Thus, we are free to use an alternate loss formulation, which
    features half the number of decision variables.</p>
    <p><strong>Proposed likelihood:</strong> I propose we use the
    following likelihood formulation, based on the original QP
    formulation of LCPs when <span class="math inline">(1/2)(F + F^\top)
    \succ 0</span>:</p>
    <p><span class="math display"> - \ln P(\xi | D) = \sum_t
    \min_{\lambda \in \mathcal C_t^\xi} \left\{\| A^\xi x_t + B^\xi u_t
    + D^\xi \lambda + d^\xi - x_{t+1} \|^2 + \frac{1}{2} \lambda^\top
    (F^\xi + {F^\xi}^\top) \lambda + {q_t^\xi}^\top \lambda\right\}
    </span> Where <span class="math inline">\mathcal C_t^\xi =
    \{\lambda: \lambda \geq 0 \text{ and } F^\xi \lambda + q_t^\xi \geq
    0\}</span> is the constraint set for the QP nested within the
    loss.</p>
    <p>I decided to see if it would be feasible to run this at real-time
    rates by timing different JAX methods for solving random QPs. I
    decided to look at <a
    href="https://jaxopt.github.io/stable/">JAXopt</a> (no longer in
    development), <a
    href="https://github.com/kevin-tracy/qpax">QPAX</a>, and <a
    href="https://github.com/MIT-Lu-Lab/MPAX">MPAX</a>. I basically
    setup problems of the form <span class="math inline">\min_\lambda
    \|D \lambda + d \|^2 + (1/\epsilon) ((1/2)\lambda^\top (F + F^\top)
    \lambda + q^\top \lambda)</span> subject to <span
    class="math inline">\lambda \geq 0, F \lambda + q \geq 0</span>.
    Here are the results:</p>
    <figure>
    <img src="image-2.png" alt="Timing tests for solving QPs in JAX" />
    <figcaption aria-hidden="true">Timing tests for solving QPs in
    JAX</figcaption>
    </figure>
    <p>As you can see, MPAX was the best, but I still feel like the
    results were borderline. If we really want to speed it up, one
    option is to try to implement OSQP <span class="citation"
    data-cites="stellato2020osqp"><a href="#ref-stellato2020osqp"
    role="doc-biblioref">[19]</a></span> in JAX myself (though that is
    what JAXopt is supposed to be doing). I didn‚Äôt really do a dive, but
    there is also ProxQP <span class="citation"
    data-cites="bambade2022prox"><a href="#ref-bambade2022prox"
    role="doc-biblioref">[20]</a></span>. We could also try to do more
    approximate things or other tricks.</p>
    <p><strong>Finally,</strong> I mentioned I might want to discuss
    Lambert et al <span class="citation"
    data-cites="lambert2020objective"><a
    href="#ref-lambert2020objective"
    role="doc-biblioref">[14]</a></span> previously in <a
    href="#some-related-works">¬ß2.2</a>; this would be the relevant
    section for that.</p>
    <h2 id="towards-cube-pivoting">5. Towards Cube Pivoting</h2>
    <h3 id="implementing-the-lag-version">5.1. Implementing the ‚ÄúLag‚Äù
    Version</h3>
    <p>I have implemented the ‚Äúlag‚Äù version of the method, where <span
    class="math inline">x_0</span> is allowed to vary. In practice/for
    now, I do this by first running each parallel Mujoco simulation
    forward with each value and then generating the LCS‚Äôs at the
    predicted states. In reality, if I am solving a bunch of QPs for
    reweighting, it might make more sense to simply solve a QP for the
    next states. I could also literally alter the QP/ADMM algorithm to
    have a <span class="math inline">u_0</span> equality constraint.
    Here is a video of block pushing on this lagged version:</p>
    <figure>
    <video src="./output.mp4" controls=""><a href="./output.mp4">Video
    of pushing a block. The block is successfully pushed, but there is a
    tip-then-recover behavior about half-way through and a non-zero
    amount of steady-state error.</a></video>
    <figcaption aria-hidden="true">Video of pushing a block. The block
    is successfully pushed, but there is a tip-then-recover behavior
    about half-way through and a non-zero amount of steady-state
    error.</figcaption>
    </figure>
    <p>It seems to push the block but I‚Äôm not sure what is up with the
    whole tip-then-recover part (maybe related to Anitescu friction?). I
    also wanted to visualize the predicted <span
    class="math inline">u</span>‚Äôs at the beginning‚Äîremember those can
    vary now‚Äîwith respect to the <span class="math inline">\mu</span>
    values. Here is that figure at a few different, but sequential
    timesteps:</p>
    <p><img src="image-1.png" /></p>
    <p>We see the right trend, but it is a bit weird at times
    (i.e.¬†predicting negative <span class="math inline">u</span>‚Äôs in
    some places). Anyways I don‚Äôt think this version of pushing is all
    that impressive, so I decided to somewhat move on.</p>
    <h3 id="trying-to-get-cube-pivoting-to-work">5.2. Trying to get Cube
    Pivoting to Work</h3>
    <p>I am finally moving on to trying to get the cube pivoting task to
    work. I‚Äôm starting by trying to simply get C3+ to complete the task
    with the correct model. For my first try, I adjusted the desired
    position from the pushing one and placed the sphere at a different
    place. When I ran C3+, it didn‚Äôt work. In order to investigate, I
    decided to make sure that the plan generated made sense. Here is a
    GIF of what I saw:</p>
    <figure>
    <img src="./tip_cube_try_1.gif"
    alt="What the MPC x‚Äôs are doing compared to running the u‚Äôs through LCS and Mujoco" />
    <figcaption aria-hidden="true">What the MPC <span
    class="math inline">x</span>‚Äôs are doing compared to running the
    <span class="math inline">u</span>‚Äôs through LCS and
    Mujoco</figcaption>
    </figure>
    <p>As you can see, the LCS thinks the cube is being tipped, but it
    is clearly not. In the GIF you can see that there is clearly a gap
    between the ball and the cube when frictional forces are applied.
    This seems to be clearly due to the Anitescu friction approximation
    <span class="citation" data-cites="anitescu2006optimization"><a
    href="#ref-anitescu2006optimization"
    role="doc-biblioref">[21]</a></span>. I think this is an interesting
    consequence to think about‚Äîperhaps could be twisted as motivation
    for having distributional robustness. The most intuitive fix would
    be to simply ‚Äúshrink‚Äù the cube in the LCS. So I tried that, but C3+
    still wasn‚Äôt really working:</p>
    <figure>
    <video src="./c3_pivot_fail.mp4" controls=""><a
    href="./c3_pivot_fail.mp4">Video of C3+ trying to do the pivoting
    task. It kinda just floats around.</a></video>
    <figcaption aria-hidden="true">Video of C3+ trying to do the
    pivoting task. It kinda just floats around.</figcaption>
    </figure>
    <p>My best guess is that the problem is hyperparameters, but I
    haven‚Äôt really gone ham trying to tune/figure it out.</p>
    <p><strong>Question:</strong> <em>What is the right way to
    hyperparameter tune / think about this problem?</em></p>
    <h2 class="unnumbered" id="references">References</h2>
    <div id="refs" class="references csl-bib-body" role="list">
    <div id="ref-bui2025push" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[1] </div><div
    class="csl-right-inline">H. Bui, Y. Gao, H. Yang, E. Cui, S. Mody,
    B. Acosta, T. S. Felix, B. Bianchini, and M. Posa, <span>‚ÄúPush
    anything: Single-and multi-object pushing from first sight with
    contact-implicit MPC,‚Äù</span> <em>arXiv preprint
    arXiv:2510.19974</em>, 2025.</div>
    </div>
    <div id="ref-aydinoglu2024consensus" class="csl-entry"
    role="listitem">
    <div class="csl-left-margin">[2] </div><div
    class="csl-right-inline">A. Aydinoglu, A. Wei, W.-C. Huang, and M.
    Posa, <span>‚ÄúConsensus complementarity control for multi-contact
    mpc,‚Äù</span> <em>IEEE Transactions on Robotics</em>, 2024.</div>
    </div>
    <div id="ref-shirai2023covariance" class="csl-entry"
    role="listitem">
    <div class="csl-left-margin">[3] </div><div
    class="csl-right-inline">Y. Shirai, D. K. Jha, and A. U.
    Raghunathan, <span>‚ÄúCovariance steering for uncertain contact-rich
    systems,‚Äù</span> in <em>2023 IEEE international conference on
    robotics and automation (ICRA)</em>, 2023, pp. 7923‚Äì7929.</div>
    </div>
    <div id="ref-shirai2023chance" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[4] </div><div
    class="csl-right-inline">Y. Shirai, D. K. Jha, A. U. Raghunathan,
    and D. Romeres, <span>‚ÄúChance-constrained optimization in
    contact-rich systems.‚Äù</span> in <em>ACC</em>, 2023, pp.
    14‚Äì21.</div>
    </div>
    <div id="ref-shirai2024robust" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[5] </div><div
    class="csl-right-inline">Y. Shirai, D. K. Jha, and A. U.
    Raghunathan, <span>‚ÄúRobust pivoting manipulation using contact
    implicit bilevel optimization,‚Äù</span> <em>IEEE Transactions on
    Robotics</em>, vol. 40, pp. 3425‚Äì3444, 2024.</div>
    </div>
    <div id="ref-shirai2025linear" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[6] </div><div
    class="csl-right-inline">Y. Shirai, T. Zhao, H. T. Suh, H. Zhu, X.
    Ni, J. Wang, M. Simchowitz, and T. Pang, <span>‚ÄúIs linear feedback
    on smoothed dynamics sufficient for stabilizing contact-rich
    plans?‚Äù</span> in <em>2025 IEEE international conference on robotics
    and automation (ICRA)</em>, 2025, pp. 11926‚Äì11932.</div>
    </div>
    <div id="ref-bakolas2016optimal" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[7] </div><div
    class="csl-right-inline">E. Bakolas, <span>‚ÄúOptimal covariance
    control for discrete-time stochastic linear systems subject to
    constraints,‚Äù</span> in <em>2016 IEEE 55th conference on decision
    and control (CDC)</em>, 2016, pp. 1153‚Äì1158.</div>
    </div>
    <div id="ref-liu2024optimal" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[8] </div><div
    class="csl-right-inline">F. Liu, G. Rapakoulias, and P. Tsiotras,
    <span>‚ÄúOptimal covariance steering for discrete-time linear
    stochastic systems,‚Äù</span> <em>IEEE Transactions on Automatic
    Control</em>, 2024.</div>
    </div>
    <div id="ref-jankowski2025robust" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[9] </div><div
    class="csl-right-inline">J. Jankowski, L. Bruderm√ºller, N. Hawes,
    and S. Calinon, <span>‚ÄúRobust pushing: Exploiting quasi-static
    belief dynamics and contact-informed optimization,‚Äù</span> <em>The
    International Journal of Robotics Research</em>, p.
    02783649251318046, 2025.</div>
    </div>
    <div id="ref-drnach2021robust" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[10] </div><div
    class="csl-right-inline">L. Drnach and Y. Zhao, <span>‚ÄúRobust
    trajectory optimization over uncertain terrain with stochastic
    complementarity,‚Äù</span> <em>IEEE Robotics and Automation
    Letters</em>, vol. 6, no. 2, pp. 1168‚Äì1175, 2021.</div>
    </div>
    <div id="ref-chen2005expected" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[11] </div><div
    class="csl-right-inline">X. Chen and M. Fukushima, <span>‚ÄúExpected
    residual minimization method for stochastic linear complementarity
    problems,‚Äù</span> <em>Mathematics of Operations Research</em>, vol.
    30, no. 4, pp. 1022‚Äì1038, 2005.</div>
    </div>
    <div id="ref-tassa2010stochastic" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[12] </div><div
    class="csl-right-inline">Y. Tassa and E. Todorov, <span>‚ÄúStochastic
    complementarity for local control of discontinuous dynamics.‚Äù</span>
    in <em>Robotics: Science and systems</em>, 2010, vol. 6.</div>
    </div>
    <div id="ref-tobin2017domain" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[13] </div><div
    class="csl-right-inline">J. Tobin, R. Fong, A. Ray, J. Schneider, W.
    Zaremba, and P. Abbeel, <span>‚ÄúDomain randomization for transferring
    deep neural networks from simulation to the real world,‚Äù</span> in
    <em>2017 IEEE/RSJ international conference on intelligent robots and
    systems (IROS)</em>, 2017, pp. 23‚Äì30.</div>
    </div>
    <div id="ref-lambert2020objective" class="csl-entry"
    role="listitem">
    <div class="csl-left-margin">[14] </div><div
    class="csl-right-inline">N. Lambert, B. Amos, O. Yadan, and R.
    Calandra, <span>‚ÄúObjective mismatch in model-based reinforcement
    learning,‚Äù</span> in <em>Learning for dynamics and control</em>,
    2020, pp. 761‚Äì770.</div>
    </div>
    <div id="ref-pfrommer2021contactnets" class="csl-entry"
    role="listitem">
    <div class="csl-left-margin">[15] </div><div
    class="csl-right-inline">S. Pfrommer, M. Halm, and M. Posa,
    <span>‚ÄúContactnets: Learning discontinuous contact dynamics with
    smooth, implicit representations,‚Äù</span> in <em>Conference on robot
    learning</em>, 2021, pp. 2279‚Äì2291.</div>
    </div>
    <div id="ref-jin2022learning" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[16] </div><div
    class="csl-right-inline">W. Jin, A. Aydinoglu, M. Halm, and M. Posa,
    <span>‚ÄúLearning linear complementarity systems,‚Äù</span> in
    <em>Learning for dynamics and control conference</em>, 2022, pp.
    1137‚Äì1149.</div>
    </div>
    <div id="ref-huang2024adaptive" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[17] </div><div
    class="csl-right-inline">W.-C. Huang, A. Aydinoglu, W. Jin, and M.
    Posa, <span>‚ÄúAdaptive contact-implicit model predictive control with
    online residual learning,‚Äù</span> in <em>2024 IEEE international
    conference on robotics and automation (ICRA)</em>, 2024, pp.
    5822‚Äì5828.</div>
    </div>
    <div id="ref-todorov2012mujoco" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[18] </div><div
    class="csl-right-inline">E. Todorov, T. Erez, and Y. Tassa,
    <span>‚ÄúMujoco: A physics engine for model-based control,‚Äù</span> in
    <em>2012 IEEE/RSJ international conference on intelligent robots and
    systems</em>, 2012, pp. 5026‚Äì5033.</div>
    </div>
    <div id="ref-stellato2020osqp" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[19] </div><div
    class="csl-right-inline">B. Stellato, G. Banjac, P. Goulart, A.
    Bemporad, and S. Boyd, <span>‚ÄúOSQP: An operator splitting solver for
    quadratic programs,‚Äù</span> <em>Mathematical Programming
    Computation</em>, vol. 12, no. 4, pp. 637‚Äì672, 2020.</div>
    </div>
    <div id="ref-bambade2022prox" class="csl-entry" role="listitem">
    <div class="csl-left-margin">[20] </div><div
    class="csl-right-inline">A. Bambade, S. El-Kazdadi, A. Taylor, and
    J. Carpentier, <span>‚ÄúProx-qp: Yet another quadratic programming
    solver for robotics and beyond,‚Äù</span> in <em>RSS 2022-robotics:
    Science and systems</em>, 2022.</div>
    </div>
    <div id="ref-anitescu2006optimization" class="csl-entry"
    role="listitem">
    <div class="csl-left-margin">[21] </div><div
    class="csl-right-inline">M. Anitescu, <span>‚ÄúOptimization-based
    simulation of nonsmooth rigid multibody dynamics,‚Äù</span>
    <em>Mathematical Programming</em>, vol. 105, no. 1, pp. 113‚Äì143,
    2006.</div>
    </div>
    </div>
  </body>

</html>