<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Herbie’s Update Write-up</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="styles.css" />
  <script defer=""
  src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <link rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">Herbie’s Update Write-up</h1>
<p class="date">2024 July 26</p>
</header>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#thinking-about-the-pitch">Thinking about the
Pitch</a></li>
<li><a href="#new-test-suite">New Test Suite</a></li>
<li><a href="#gradient-computation">Gradient Computation</a></li>
<li><a href="#looking-forward">Looking Forward</a></li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>I got the following feedback from last time:</p>
<ul>
<li>For the pitch: connecting to downstream task, demonstrate better
reconstructions, and couple with V-PRISM</li>
<li>Create a test suite of 5-10 examples</li>
<li>Then, explore gradient computation</li>
</ul>
<p>I didn’t have a ton of time this week to spend on stuff, but below is
what I have.</p>
<h2 id="thinking-about-the-pitch">Thinking about the Pitch</h2>
<p>Previously, the pitch was something like:</p>
<ul>
<li>Detailed, accurate 3D reconstructions allow robots to better reason
about 3D geometry, which is useful for many manipulation tasks</li>
<li>Most SoTA methods are not physically accurate/stable, so there is
room for improvement.
<ul>
<li>Methods that do are either non-differentiable <span class="citation"
data-cites="song2018inferring">[1]</span> or use heuristic loss terms
<span class="citation" data-cites="agnew2021amodal">[2]</span></li>
</ul></li>
<li>We will create a loss term that penalizes physical stability of a
scene that can be used in two ways:
<ul>
<li>During training similar to <span class="citation"
data-cites="agnew2021amodal">[2]</span></li>
<li>During optimization-based reconstruction like in <span
class="citation" data-cites="park2019deepsdf wright2024v">[3],
[4]</span></li>
</ul></li>
<li>Ideally, we would like our method to improve:
<ul>
<li>Shape completion/reconstruction accuracy</li>
<li>Downstream task success</li>
</ul></li>
</ul>
<p>Thinking about what downstream tasks we could show success with, we
could do a similar sort of thing to <span class="citation"
data-cites="agnew2021amodal">[2]</span>:</p>
<ul>
<li>Different robotic tasks (grasping, pushing, and pulling) and did the
following:
<ul>
<li>First reconstruct the scene</li>
<li>Then plan a trajectory with the 3d reconstruction for the task</li>
<li>Finally the trajectory is executed with the original object (all in
sim).</li>
</ul></li>
<li>They released this benchmark I think, so it would be possible to
reproduce it
<ul>
<li>They didn’t release their NN model weights though, so it will need
to be retrained for direct comparison.</li>
</ul></li>
</ul>
<p><strong>Question:</strong> Could we just do something like connecting
our method with a pushing or grasping or something task in simulation
for downstream stuff?</p>
<h2 id="new-test-suite">New Test Suite</h2>
<p>Some concerns were brought up about overfitting to the square
example:</p>
<p><img src="./fake_2d_data.png" /></p>
<p>As such, it would be a good idea to come up with a few different
examples that could be used to prevent overfitting. I was thinking we
could have the following examples</p>
<ul>
<li>2D square (above)</li>
<li>2D circle</li>
<li>2D tall hourglass</li>
<li>3D cube</li>
<li>3D mesh of something (like mustard bottle)</li>
<li>3D real-world object</li>
</ul>
<p>Here are examples of what some of that fake data would look like (2D
examples):</p>
<div class="columns">
<div class="column">
<p><img src="./fake_2d_data_circle.png" /></p>
</div><div class="column">
<p><img src="./fake_2d_data_square.png" /></p>
</div><div class="column">
<p><img src="./fake_2d_data_hourglass.png" /></p>
</div>
</div>
<p>Then, I figure I could port over something like this for the 3D
cube:</p>
<p><img src="./cube_primitive.png" /></p>
<p>For the more complex stuff, we could do:</p>
<div class="columns">
<div class="column">
<p><img src="./rgb_airplane.jpg" /></p>
</div><div class="column">
<p><img src="./rgb_bottle.jpg" /></p>
</div>
</div>
<p><strong>Question:</strong> Do we feel this suite would provide a
comprehensive evaluation of the method?</p>
<p>I need to add some updates to my code for the 3D stuff to handle
rotations, etc. correctly.</p>
<p><em>Also:</em> We will have to update things when we move to
multi-object setups</p>
<h3 id="hourglass-physics">Hourglass physics</h3>
<p>As an aside, here is an example of reconstruction and physics with
the hourglass 2D example</p>
<p><strong>Reconstruction:</strong></p>
<p><img src="./svgd_recon_before_hourglass.png" /></p>
<p><strong>Physics:</strong></p>
<p><img src="./physics_before_hourglass.gif" /></p>
<p><em>Maybe I need to do some tuning here.</em></p>
<h2 id="gradient-computation">Gradient Computation</h2>
<p>Last time, I brought up some concerns about gradients. I based my
investigation loosely off of <span class="citation"
data-cites="metz2021gradients">[5]</span>. I found that there was
evidence of exploding gradients:</p>
<div class="columns">
<div class="column">
<p><img src="./jac_physics_recon.gif" /></p>
</div><div class="column">
<p><img src="./jacobian_norms_recon.png" /></p>
</div>
</div>
<p>Specifically, I was looking at the Jacobian of the dynamics <span
class="math inline">\partial s_t / \partial s_0</span> (The above image
is the norm of the Jacobian <span class="math inline">\partial s_t /
\partial w</span>). The explosion is likely due to the spectral
properties of the Jacobian of the dynamics function being iterated.</p>
<p>In <span class="citation" data-cites="metz2021gradients">[5]</span>,
there were a few suggestions for dealing with this:</p>
<ul>
<li><strong>Smoothing:</strong> “Contact ‘softening’ has proven
particularly fruitful.”</li>
<li><strong>Black-Box Gradients:</strong> “Sometimes, black box gradient
estimates can result in lower variance gradient estimates”</li>
</ul>
<p>I also had the idea that perhaps an exponentially decaying loss
function would help with this problem. Then, the loss would be something
like:</p>
<p><span class="math display"> L_\text{stable} = \frac{1}{T}\sum_{t=1}^T
\frac{\alpha^t}{2} \|s_t - s_0 \|^2 </span></p>
<p>for <span class="math inline">0 &lt; \alpha &lt; 1</span>. Here is a
graph of the norm of the gradient of the above loss for <span
class="math inline">\alpha = 0.95</span> in the above setup (note the
scale is 1e7 instead of 1e12):</p>
<p><img src="./recon_loss_grad_norms.png" /></p>
<p><strong>Question:</strong> Do we think this could work at combatting
gradients problem?</p>
<h3 id="on-smoothing">On Smoothing</h3>
<p>In <span class="citation" data-cites="metz2021gradients">[5]</span>
both smoothing of contact and randomization/probabilistic treatment of
dynamics were talked about as potential solutions to the high variance
of jacobians problem. In <span class="citation"
data-cites="pang2023global">[6]</span>, an equivalence between the two
was drawn. I think this could be a promising approach, but would take a
little bit of thought to adapt to the current setup. Currently, I have a
spring-damper setup similar to <span class="citation"
data-cites="geilinger2020add xu2022accelerated">[7], [8]</span>, but
would like to “smooth” things out. This would probably require replacing
the <span class="math inline">\text{ReLU}</span> functions with a <span
class="math inline">\text{Softplus}</span> function.</p>
<h3 id="on-black-box-gradients">On Black-Box Gradients</h3>
<p>Originally, REINFORCE is mentioned as an example of computing
Black-Box gradients. Some methods using Complex Step Finite Differencing
(CSFD) <span class="citation" data-cites="martins2003complex">[9]</span>
was mentioned, which has been used for SLAM <span class="citation"
data-cites="peng2024x">[10]</span> and deformable simulation <span
class="citation" data-cites="luo2019accelerated">[11]</span>:</p>
<p><span class="math display"> f&#39;(x) \approx \text{Im}\left(
\frac{f(x + hi)}{h} \right)</span></p>
<p>These seem really cool, but there might have to be some thought about
using this with high dimensional gradients.</p>
<h2 id="looking-forward">Looking Forward</h2>
<p>Looking forward, I want to do the following next week:</p>
<ul>
<li>Finish test suite</li>
<li>Create V-PRISM presentation</li>
</ul>
<p><strong>Other Questions:</strong></p>
<ul>
<li>What other things should I focus on?</li>
<li>How should I go about investigating the gradients problem
(explosion)?</li>
</ul>
<h2 class="unnumbered" id="references">References</h2>
<div id="refs" class="references csl-bib-body" data-entry-spacing="0"
role="list">
<div id="ref-song2018inferring" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">C.
Song and A. Boularias, <span>“Inferring 3d shapes of unknown rigid
objects in clutter through inverse physics reasoning,”</span> <em>IEEE
Robotics and Automation Letters</em>, vol. 4, no. 2, pp. 201–208,
2018.</div>
</div>
<div id="ref-agnew2021amodal" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">W.
Agnew, C. Xie, A. Walsman, O. Murad, Y. Wang, P. Domingos, and S.
Srinivasa, <span>“Amodal 3d reconstruction for robotic manipulation via
stability and connectivity,”</span> in <em>Conference on robot
learning</em>, 2021, pp. 1498–1508.</div>
</div>
<div id="ref-park2019deepsdf" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">J.
J. Park, P. Florence, J. Straub, R. Newcombe, and S. Lovegrove,
<span>“Deepsdf: Learning continuous signed distance functions for shape
representation,”</span> in <em>Proceedings of the IEEE/CVF conference on
computer vision and pattern recognition</em>, 2019, pp. 165–174.</div>
</div>
<div id="ref-wright2024v" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">H.
Wright, W. Zhi, M. Johnson-Roberson, and T. Hermans, <span>“V-prism:
Probabilistic mapping of unknown tabletop scenes,”</span> <em>arXiv
preprint arXiv:2403.08106</em>, 2024.</div>
</div>
<div id="ref-metz2021gradients" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">L.
Metz, C. D. Freeman, S. S. Schoenholz, and T. Kachman, <span>“Gradients
are not all you need,”</span> <em>arXiv preprint arXiv:2111.05803</em>,
2021.</div>
</div>
<div id="ref-pang2023global" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div><div class="csl-right-inline">T.
Pang, H. T. Suh, L. Yang, and R. Tedrake, <span>“Global planning for
contact-rich manipulation via local smoothing of quasi-dynamic contact
models,”</span> <em>IEEE Transactions on robotics</em>, 2023.</div>
</div>
<div id="ref-geilinger2020add" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div><div class="csl-right-inline">M.
Geilinger, D. Hahn, J. Zehnder, M. Bächer, B. Thomaszewski, and S.
Coros, <span>“Add: Analytically differentiable dynamics for multi-body
systems with frictional contact,”</span> <em>ACM Transactions on
Graphics (TOG)</em>, vol. 39, no. 6, pp. 1–15, 2020.</div>
</div>
<div id="ref-xu2022accelerated" class="csl-entry" role="listitem">
<div class="csl-left-margin">[8] </div><div class="csl-right-inline">J.
Xu, V. Makoviychuk, Y. Narang, F. Ramos, W. Matusik, A. Garg, and M.
Macklin, <span>“Accelerated policy learning with parallel differentiable
simulation,”</span> <em>arXiv preprint arXiv:2204.07137</em>,
2022.</div>
</div>
<div id="ref-martins2003complex" class="csl-entry" role="listitem">
<div class="csl-left-margin">[9] </div><div class="csl-right-inline">J.
R. Martins, P. Sturdza, and J. J. Alonso, <span>“The complex-step
derivative approximation,”</span> <em>ACM Transactions on Mathematical
Software (TOMS)</em>, vol. 29, no. 3, pp. 245–262, 2003.</div>
</div>
<div id="ref-peng2024x" class="csl-entry" role="listitem">
<div class="csl-left-margin">[10] </div><div class="csl-right-inline">Z.
Peng, Y. Yang, T. Shao, C. Jiang, and K. Zhou, <span>“X-SLAM: Scalable
dense SLAM for task-aware optimization using CSFD,”</span> <em>ACM
Transactions on Graphics (TOG)</em>, vol. 43, no. 4, pp. 1–15,
2024.</div>
</div>
<div id="ref-luo2019accelerated" class="csl-entry" role="listitem">
<div class="csl-left-margin">[11] </div><div class="csl-right-inline">R.
Luo, W. Xu, T. Shao, H. Xu, and Y. Yang, <span>“Accelerated complex-step
finite difference for expedient deformable simulation,”</span> <em>ACM
Transactions on Graphics (TOG)</em>, vol. 38, no. 6, pp. 1–16,
2019.</div>
</div>
</div>
</body>
</html>
